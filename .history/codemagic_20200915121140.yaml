# Check out https://docs.codemagic.io/yaml/building-a-react-native-app/ for more information
# Please review and update values in curly braces

workflows:
    react-native:
        name: React Native App
        environment:
            vars:
                # XCODE_WORKSPACE: "{{ ADD WORKSPACE NAME HERE }}"
                # XCODE_SCHEME: "{{ ADD SCHEME NAME HERE }}"
                CM_KEYSTORE: Encrypted(Z0FBQUFBQmZTVkVWUnRCbWU5Q2Z5aW04YTBJU1pCUzFYNVRYYktRSzZDanJUZmxxeEM3SEZJd2tPSzVDT3cyclpQcjhtOU9jZ09peWNwYXh1TjA3Smk2ZjFuekg4eXI2WDBqX1VwN0NZU214N2xDekxhMjhXUzBzOTN6OFlqQWtjejR3Qm5fN0FJd3pUWnBhUnczaWt3bXJ4andXVGFielNvUTRQT2tCODNKZkZLUEppLU5JZk5tWTg4NW1wZmQ4LVY1VVM4eDJzckJENFpjRDNBcllqZlN6UFFBVUhrb21XVVFLblpubjJQeVVwS3pndHprU0NtVzB2ekc5c2ZHQ3NfUmpVUmRlalRyTm16N0l1cFBBcnVBWi1mTDA1RFVfcF9HUVJnT0JHV3lQdzJFLW1FZmVrYTJ1NVV0ZXk5RTExekZZWVRENDB2eEZ5VkFRdnFMWHZyY2lyR1BBbHdpbW11Nk1LYUNyNldGSjM3TFNRM3B1NmhBVlpBZmVFMUtaWTA4c3dqcnNoXzFfa253Ykt1WVU3NVNEVXNIQWFVNEVjSXhIY3pMWlFmOERRWU5QRkpNWWtkWUVhZ0JiRW93QmpmZGEtMHVqMl9saHk1OWhhOXZOS01hVU9qdVV0Y3NQZHpZQWthY1lTYlBYSmlkU3lJMUJ2VTVMMHl5VDFDT0phUUJ5aENWNEZjZlJEcW1IOFN6N0tRUkpDamxhNXlPekxhYTlXc0lqQjM4bVQzc1pUenZTY2UtNnJCUWM3THMzVXhOWjNUQl9tcy1ubWkyVzVaQ2tBaUhGNnY2TEhiTUNuSTZoMmg3SlJ0QVRKWWttbURTeWhVNGhBbUZpemFOS0lOVUk2QlhOdExWSFotRXlMdk1MOVQtSVp1MWdXMXU0MEdpLW45VnFZR1VfbTJwTXBMdmtycW04b3J6UzR5ckZIczZyNUhsa1ZCaXBFbXpnQkZ3VjlDYnpmMDR3R0N0Z0N0VjFBZG1qWlJaLXZmVzRtQVMzdzNQOUJNbVpqQ2VfNnpPcGNVMmxCS29UQXBYb0otRDVhUGRhMXBkZGVZNkNBOC13QmNKd21ucFdhSWR1aUh0R0FhRzRRSGE4M2h4cnFaRHFlT1RxcnFiNjB3QXc3WWU2NHNmZ0ExZVhzdFAtUXo2eW5tdGJIY3JYRzFiSG9lVTBKcDZya0NJRWFncEVwLUV1MnN4RHByaGNrTU9YODRuY0lfTFZtOGxLY0x0VGlRQ2kyYmMySVVnUWpBc2ZzeWs2dEZUaUMydldoWnJpaGdPdUlfV1owX21BbnM1cFMzMno3UG9VV0JiWmtONDA5OUVtNDZOam9tZVN2WHVZRUJMY2xpNVhhMlhVVFR5cEhYVTdlS2RUekpGMDdxc0Fqc1AtbUJSSmpqT2FBSFdieXVNbkJTeC1Fbl9jeUZUc2NzdU1IbURmcHl0SWwzWTRRb2E5RHFvR1VfXzA3VzdJbWdhTkt4dzBoSERoaFI2S1ZmYUVFV3g2MzdrVmZ5R2tRdmNMb1MyWFNRWXd2QWRpQnUtSmNBUHBBV1NlcGl2VUhkVHVJMFU2VnNqSHc3SG01UGZ6Z0tMTDdkVzlTVHB3Y192ZXBiU3AtX0dxMC16THQ2MEtkaUJ5b0o3QjJqZFkwdGwzZTJ6aWtDZnpldV9iMXlyWkFsdUtDTGUtRzNPcGFvaGI4UnVpcFU2alNPVnl0OEs3cm9YQXpuNGduS0I0Rm5QcU9XV29rcXJ3alUxTzg5RkFoMlFPLW9Ka1VQTThVaDhJNVBiNUVHSi1PMlFUcWdRRU9GTlF6ejhVQVFLcnE1NkVLeWlnaVVjREx0NmVhbGhsR2o2UVF2T2hJeWFNbWIzeG9CenN6WjREeFJobklwNVpWdXJqdVdiX3J1RWFnV1Q4aUhFSXZEN2h6MU9KV0wyWXdaNXppV1VGN25EZnpoRExuaGtjSW9uZ0dfZTVEUzN1MFgyOEl2dVFVM1FVRUh6LVFseHBLeFhDZTNieUc0akxhWVRhSWs5dTNTQ3VNM0xIajlEa3RKWURLN20tNXRuSXZmdG9CWXNvVXIwclI1dGdxRUNURlFuV3JRM3dmZmtwRmt2MjdHaVVkd1kwRkQ1VE44ZVB4SFZ5Zzhud1B6VDBDRERISExTdW1rNjFfOXNoNHZpY3ZRX3NKSHBMVmJNd2w1aklfdVQweUM5bklLZEcyVkRyMTBtb0x5QXpfaG9yYzhzVEgxYTNvMVIwZTFUdnpsYVBRTzdhTldLd3lEcWFzcmpjNERTUkMyM2hMeTFtQnB2MTZ0bk5BemEycUl4SDdmVm9xdHAySWlqNVB0Zm5vTHdsejJrcGU1cnhGSDY5dXFCQk5GcFN1LUVGZ0FOY0xkUm5jZVpoREhuUWU1T2VIM1BIUkVQb0JscmNKclF6M082QXZ6TXVVZVNfWHcxbmJlUjIwX0huMy1NN3V0aWxQT2lIU1hZRDdRanZpS19lV1RkQTdvOTBiVURaYVQ1R0JKVHJ1UkIxWFFyc3h3WkFlel80NjlScUg2Zmt4QjJxakhpYlk4MHRwRUljSkJFY01WeFdHWThXbS1DX1JQSGwzMV9hM0hBWmJ4QTVOTFJMaG1NNk04VUxxbDdieXJtSllzSEtLSDZuWlZfblVFMWJhVXRjcWdrYXk0b0xfVjlOMjVBTmlwM1hCYXJjaTV6dGxGMVNoYzliUi1VOGFHWXE0cU03MUl0djZKQWxwTDJ4bTdBdEtwT2l4S3JvQkFpTmE0Xzc0aGktUU0wQnZES0wxdWdsVE1tdUx6d2RPYlZyekpFR00teTZNV3JXVllKWHBPSFd5NDNQb3dBR3lkX014XzZma090NFFKSk05dXFZVzlZOWJ2aS1Ld1FmcTZqcFRkcmVOQmppZlk0ZWhITUI3UUQxRDZQQ0NlOE9KNXNpQnI5b0FmN1VFY2F6eU4zY1pBeUtoWENjWWNaZ29VMGY1MGNhTVcwcVFkaFh5T3B0VHg1a3hsaDlxb2FFWWp4TWNPd084bEE5MnhHeWxSa0xFTW4yMEwwTVJxTEVUbVUybmRFVk1TMWx2VXFkSTFDdkZHYjU3QUV2RWFXWlJWREJ4UzF3WmJRMHRwTWtHN1JkQTNuZEFlNzdXRXBOejFjWTU2ZFBCSW1laVZfU1BJWFp4eFlsbE9MNWRKcFlQOXZHeVVZRzBKc2VsUWJvVWlMUHA2MG1nd0FyQ2NJV2oxSVdidjdPUEtabGItamdHemhsNzZ1TVR3cmJGazJfWGpyRmtqVDlLSVhhdFkteS1FWVRLc3pCWkJTS092QzVDd2lmQ2YzV3BQQWVkM2VDNUZJcjBXUEJULUk2emtzaW9zMGdXX05YbllVZEkwU09rUFlQZVp6R3BKYVpINzZRdGJlVVJHdy1pSHhoSXdEeWdRajNBZjljWjBUZmg0UkpCOXV6aHBYVHd4NlJVUDhFY0E2U0NFUy1aQTRxbi1ndVJLSkxHRHozMnhfdk5aajFWbnJhdmdYdHFfaXJLMmVBS0NsNlA4WnJRdXZEWnRoV19ySDItTEpRZkFjUU1UbllKdV8tVUkzRzUtajdPMURTbWFrQ2piaHVJNlNaZTlQc2xMWExRWmRtbU9KUWQ3WF9jS3JMZEk1Sm9LLXBlRkpOcldDWkhUdDJFaENCaEVjamZJZkpjUlRkLUkzVnJVcU1wRDFSeUxBUkh0UzRiZUwwaUlmaUhQbmFTNWxISm9KcncxSjc1eDJna0lrc2NLVXlQODRYelRqVHd3dGl5aUJPQVg0Q2J5bDd0V1pLWmFuLUUxMmx0b1VDT045NnF6aWVYM2ZQUC1sTXUyUWdMcEdRRHd2OWdFMUFsdHdyWWdlbEVWX3B6dDRoYmZvQTZXS1ZPTGpiS0ZOa0NSVUw4Mk0zdHZQa1Y4cHhMOHlzVERKOWJCOWpxZklBN2g5WnNsWmlpVFRMRzlmR0ZMNFFpVUk1Y0VRQS1yNFUtRkFMUkFBU3JTR0pwb1d3WmxMWkNtTkpPdGM5c2k5bzNSa2V1OUpXZXYyclRFeXNZWElWM25uT1A4cGlQUnR6dFJEcXdCSkhoLW0wSFcyU0hJQjVHTkxUbER1YWluejRHUENLTDJjZ2pnSzZneVhvTk9tbU1hcXhqSXdiLWhQbG1SZmNRa19aYm83Tl85Q3dadFpTeUcyRzhIOEsxNURDZ0FQa3FjdmtOME9NTXh6V3Y5QlFpWDF5Q1hRRURaLVlUZTE4RTFnaTBtNl9iREp6NHNDUWdJcUNwdl9ZSzVYTXlRX1U3WGo5dVFyanU4cUtkR2ZVa1Rjc21HMTR3UU5FOVpIRjBmX1NyT01penlVcmhFLXpJdWV0VFFLWnFrVHpHUERHeXRnMExLMFF1SGFLNWZCc19NTHlMU3lTREpVT3lnbGhzcTBDM0Fqa09sVHhlWGRmU1M3UFVzNk9KTlZfZmVMck1wb0pRa0gzdTZJWjNQWnBLTlB0TmowWS12YnY0RjQ2UGhJcW1JeDVzcnNtdGxBc3JCX1Q2aGE2MU5id0Rud2o0VFBGQTZqbFdFZGlDS3U1clhnYV9HZ0huWGtGSHNDZ1dTV2E1Q2xHQ1dNRUJ2THNxbnBvVUNPZGNfN09penNSRV94U3Q2TE5rOGJYeFQxQWVBVjlBTUxoamwyTDZNNUUwS1dmQ0RFQTloblpPRjYzRkVaOWtkSXNWZDRZdDByc2dWR1hKOHZpbGoyY1hWakdhRjZDMWVucXY2QU9OazlUc1hSdXVqc2ItRjdBM0tXalV2T0NMbzhMT0JDQlJDaGRINlBSQlJiSmhSRXdGU3AwRnZYRDQ4S0tuUmRlcm1wN3JLYl8zZTlJcjZPWkpKeVFlZzlSN2pOTVhNaUprcFRvVDVkNDZVVWdFeXBtQzlCTFNwY2FjcWZRWElQeVFRakJNWFJrS3gtdWhTbi16RnVQZmsyaVc4NWYzNHJ6dWs1dXFWRkFWR1dWRkdPbllERWEwWHcxTDQ0RVNURThhSTRGdkdJTG1aNUxDSUsxdnZjUU0yZERlS0lteVI4V0tkSzlORlA4V01oek1RSjdxbzIzOWotd2p3M1pzRmFXeWVBbms0UDhWcmd1NThycTJHUC01QTQzMTdmUmxLdFFheTBMbS04cTYwOWV5ZFZZMU10T1lmdWJ3WlNiaXM1Mm10Y2tyN0RaNUo4NENOTnZCTWEwaGtjUWZFU3MtSkk4VEIzUFFYWjNhUzVEODFzYVp1M0l1ZWk4NGZUWlp6RVROcGpLeGRJU045dExCQ05ZZk9WWGNTdUVtdVJ5ejNJc3BxcERCelpTTlFCOWEwcE1ZR2szdFJMVGNhdS15Q2lwazluWlhhVnBzdEE3aWFmSmdBWXlFdHJ2WTY0NXNhS0pGRWxBak4wbG0wV3ZucnZzZUtpS0FoVWkxcVNscEFHd3V5dkJDR05oQVRUVEpFOD0=)
                CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmZTVkczblU5SkRfR0NKZlp0OG1ZNDd3QzJVdzlIckNISl9JNjFtckhIeFQ0aXBNUEdhZ1lwM1lVdVRKaTZITGcwemhpSWlqdm9oRXVpd0N3anRhdXF1MDJ5VHc9PQ==)
                CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmZTVkczblU5SkRfR0NKZlp0OG1ZNDd3QzJVdzlIckNISl9JNjFtckhIeFQ0aXBNUEdhZ1lwM1lVdVRKaTZITGcwemhpSWlqdm9oRXVpd0N3anRhdXF1MDJ5VHc9PQ==)
                CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmZTVkczblU5SkRfR0NKZlp0OG1ZNDd3QzJVdzlIckNISl9JNjFtckhIeFQ0aXBNUEdhZ1lwM1lVdVRKaTZITGcwemhpSWlqdm9oRXVpd0N3anRhdXF1MDJ5VHc9PQ==)
            node: latest
        triggering:
            events:
                - push
                - tag
                - pull request
            branch_patterns:
                - pattern: master
                  include: true
                  source: true
        scripts:
            - npm install
            - echo "sdk.dir=$HOME/programs/android-sdk-macosx" > "$FCI_BUILD_DIR/android/local.properties"
            - name: Set up keystore
              script: |
                    echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
                    cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
                    storePassword=$CM_KEYSTORE_PASSWORD
                    keyPassword=$CM_KEY_ALIAS_PASSWORD
                    keyAlias=$CM_KEY_ALIAS_USERNAME
                    storeFile=/tmp/keystore.keystore
                    EOF
            - |
                # build Android
                cd android
                ./gradlew assembleDebug
            # - |
            #     # build iOS
            #     cd ios
            #     pod install
            #     xcodebuild build -workspace "$XCODE_WORKSPACE.xcworkspace" -scheme "$XCODE_SCHEME" CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO
        artifacts:
            - android/app/build/outputs/**/*.apk
            - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
            - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM
        publishing:

